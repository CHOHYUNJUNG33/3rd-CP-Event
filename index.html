<!DOCTYPE html><html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>3차 컴플라이언스 이벤트 - 점수판 연동</title>
  <link href="https://cdn.jsdelivr.net/gh/webfontworld/gmarket/GmarketSans.css" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      font-family: 'GmarketSans', sans-serif;
      background: #fff;
    }
    #game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: url("abcd.PNG") center/cover no-repeat;
      overflow: hidden;
    }
    .word {
      position: absolute;
      font-size: 1.5vw;
      font-weight: bold;
      color: #5a3e36;
      z-index: 2;
    }
    #input-area, #start-screen, #restart-btn, #complete, #leaderboard {
      z-index: 10;
      position: absolute;
    }
    #input-area {
      bottom: 0; width: 100%; background: rgba(255,255,255,0.9); text-align: center; padding: 10px;
    }
    #word-input {
      width: 60%; height: 40px; font-size: 1.2vw; border-radius: 8px; border: 2px solid #ccc;
    }
    #start-screen {
      top: 0; left: 0; right: 0; bottom: 0; display: flex; justify-content: center; align-items: center;
    }
    #start-button, #restart-btn {
      padding: 12px 24px; font-size: 1.2vw; font-weight: bold; border-radius: 12px; border: 2px solid #d36c8d;
      background: linear-gradient(to bottom, #ffd6e1, #fbb0c7); box-shadow: 0 4px #b85274; cursor: pointer;
    }
    #restart-btn { top: 20px; right: 20px; display: none; }
    #complete {
      top: 30%; left: 50%; transform: translateX(-50%); padding: 20px; background: #fff0f5;
      border-radius: 12px; display: none; text-align: center;
    }
    #timer {
      position: fixed;
      bottom: 20px;
      left: 20px;
      font-size: 1.2vw;
      font-weight: bold;
      background: rgba(255,255,255,0.8);
      padding: 6px 12px;
      border-radius: 10px;
      z-index: 10;
    }
    #leaderboard {
      top: 20px;
      left: 20px;
      background: rgba(255,255,255,0.9);
      padding: 10px 20px;
      border-radius: 10px;
      max-width: 300px;
    }
    #leaderboard h3 { margin-top: 0; }
  </style>
</head>
<body>
  <div id="game-container">
    <div id="start-screen">
      <button id="start-button">게임 시작</button>
    </div>
    <button id="restart-btn">다시 시작</button>
    <div id="input-area" style="display: none;">
      <input type="text" id="word-input" placeholder="단어를 입력하세요" />
    </div>
    <div id="complete"></div>
    <div id="timer">00.00초</div>
    <div id="leaderboard">
      <h3>실시간 순위</h3>
      <ol id="ranking-list"></ol>
    </div>
  </div>  <!-- Firebase SDK -->  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDmAU5DzdxpIotxcH0b4HQFzGbp1Wat7dA",
      authDomain: "rd-cp-event.firebaseapp.com",
      projectId: "rd-cp-event",
      storageBucket: "rd-cp-event.firebasestorage.app",
      messagingSenderId: "459007448670",
      appId: "1:459007448670:web:d40a5aedab936b191c46cf"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const baseWords = ["하도급", "계약서", "지급기한", "공정위", "공정거래", "단가조정", "갑질금지", "서면발급", "법위반", "기술탈취", "정산", "하도급법", "과징금", "거래공정", "기명날인", "계약내용", "감독", "대금지급", "자료요구", "상생협력", "재하도급", "작업지시서", "증빙서류", "부당특약", "인테그리티"];
    const shuffledWords = baseWords.sort(() => 0.5 - Math.random()).slice(0, 25);

    const container = document.getElementById("game-container");
    const startBtn = document.getElementById("start-button");
    const restartBtn = document.getElementById("restart-btn");
    const inputArea = document.getElementById("input-area");
    const inputBox = document.getElementById("word-input");
    const completeBox = document.getElementById("complete");
    const rankingList = document.getElementById("ranking-list");

    let fallingWords = [];
    let timerInterval, dropInterval, startTime;
    let totalWords = 25;
    let typedCount = 0;
    let gameEnded = false;

    function createWord(word) {
      if (gameEnded) return;
      const div = document.createElement("div");
      div.className = "word";
      div.textContent = word;
      div.style.left = Math.random() * 80 + "%";
      div.style.top = "0px";
      container.appendChild(div);
      fallingWords.push({ word, element: div, y: 0 });
    }

    function dropWords() {
      dropInterval = setInterval(() => {
        for (let fw of fallingWords) {
          fw.y += 1.5;
          fw.element.style.top = fw.y + "px";
          if (fw.y > container.offsetHeight - 60) {
            endGame("실패! 단어를 놓쳤어요.", false);
          }
        }
      }, 30);
    }

    function checkInput(input) {
      for (let i = 0; i < fallingWords.length; i++) {
        if (fallingWords[i].word === input.trim()) {
          container.removeChild(fallingWords[i].element);
          fallingWords.splice(i, 1);
          typedCount++;
          if (typedCount === totalWords) {
            const time = ((Date.now() - startTime) / 1000).toFixed(2);
            promptForNameAndSaveScore(time);
            endGame(`성공! 기록: ${time}초`, true);
          }
          break;
        }
      }
    }

    function endGame(message, isSuccess) {
      gameEnded = true;
      clearInterval(dropInterval);
      clearInterval(timerInterval);
      completeBox.innerHTML = `<p>${message}</p>`;
      completeBox.style.display = "block";
    }

    function startGame() {
      startBtn.style.display = "none";
      restartBtn.style.display = "block";
      inputArea.style.display = "block";
      completeBox.style.display = "none";
      fallingWords = [];
      typedCount = 0;
      gameEnded = false;
      shuffledWords.forEach((w, i) => {
        setTimeout(() => { if (!gameEnded) createWord(w); }, i * 1500);
      });
      setTimeout(dropWords, 1000);
      startTime = Date.now();
      timerInterval = setInterval(() => {
        const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
        document.getElementById("timer").innerText = `${elapsed}초`;
      }, 100);
    }

    function promptForNameAndSaveScore(score) {
      const name = prompt("별명을 입력하세요 (10자 이내)")?.trim().slice(0, 10);
      if (!name) return;
      db.ref("scores").push({ name, score: parseFloat(score) });
    }

    function loadLeaderboard() {
      db.ref("scores").orderByChild("score").limitToFirst(5).on("value", snapshot => {
        const list = [];
        snapshot.forEach(child => {
          list.push(child.val());
        });
        rankingList.innerHTML = list.map((d, i) => `<li>${i + 1}위: ${d.name} - ${d.score}초</li>`).join("");
      });
    }

    startBtn.addEventListener("click", startGame);
    restartBtn.addEventListener("click", () => location.reload());
    inputBox.addEventListener("keydown", e => {
      if (e.key === "Enter") {
        checkInput(inputBox.value);
        inputBox.value = "";
      }
    });

    loadLeaderboard();
  </script></body>
</html>
